<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Service Endpoints - Ultimate Kubernetes Bootcamp</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Service Endpoints";
    var mkdocs_page_input_path = "7_exposing_app_with_service.md";
    var mkdocs_page_url = "/7_exposing_app_with_service/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Ultimate Kubernetes Bootcamp</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Setup</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Single Node</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../minikube/">Option 1 - Minikube</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../minikube/">Option 2 - Docker for Mac/Windows</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Multi Node</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../2_kube_cluster_vagrant/">Provisioning Nodes with Vagrant</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../3_install_kubernetes/">Option 1 - Kubeadm - Bring Your Own Nodes (BYON)</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../3_install_kubernetes/">Option 2 - Google Cloud Platform</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../kube_visualizer/">Visualizing Kubernetes</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Bootcamp</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../5_deploying_pods/">LaunchPod - Working with Pods</a>
                </li>
                <li class="">
                    
    <a class="" href="../4_configs/">Configuring Cluster</a>
                </li>
                <li class="">
                    
    <a class="" href="../6_kubernetes_deployment/">Creating Deployments</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Service Endpoints</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#exposing-application-with-a-service">Exposing Application with  a Service</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#publishing-a-service-with-nodeport">Publishing a service with NodePort</a></li>
        
            <li><a class="toctree-l4" href="#exposing-the-app-with-externalip">Exposing the app with ExternalIP</a></li>
        
            <li><a class="toctree-l4" href="#exposing-the-app-with-loadbalancer">Exposing the app with LoadBalancer</a></li>
        
            <li><a class="toctree-l4" href="#headless-services-with-endpointsexternal-names">Headless services with Endpoints/External Names</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../8_rollouts_and_rollbacks/">Rollouts and Rollbacks</a>
                </li>
                <li class="">
                    
    <a class="" href="../9_deployement_strategies/">Deployment Strategies</a>
                </li>
                <li class="">
                    
    <a class="" href="../9_using_configmaps_and_secrets/">Using Configmaps and Secrets</a>
                </li>
                <li class="">
                    
    <a class="" href="../10_kubernetes_autoscaling/">Auto Scaling Capacity with HPA</a>
                </li>
                <li class="">
                    
    <a class="" href="../11_deploying_sample_app/">Mini Project</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Additional Topics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../cluster_setup_kubespray/">Production grade setup with Kubespray</a>
                </li>
                <li class="">
                    
    <a class="" href="../12_troubleshooting/">Troubleshooting Tips</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Securing Kubernetes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../configuring_authentication_and_authorization/">Authentication and Authorization</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Ultimate Kubernetes Bootcamp</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Bootcamp &raquo;</li>
        
      
    
    <li>Service Endpoints</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="exposing-application-with-a-service">Exposing Application with  a Service</h1>
<p>Types of Services:   </p>
<ul>
<li>ClusterIP</li>
<li>NodePort</li>
<li>LoadBalancer</li>
<li>ExternalName</li>
</ul>
<p><img alt="kubernetes service" src="https://github.com/schoolofdevops/ultimate-kubernetes-bootcamp/blob/master/images/k8s_service.jpg?raw=true" /></p>
<pre><code>kubectl get pods
kubectl get svc
</code></pre>

<p>Sample Output:</p>
<pre><code>NAME                         READY     STATUS    RESTARTS   AGE
front-end-64597c55f8-dk6g7   1/1       Running   0          4m
front-end-64597c55f8-mkp2h   1/1       Running   0          4m
front-end-64597c55f8-r2c54   1/1       Running   0          4m
</code></pre>

<h2 id="publishing-a-service-with-nodeport">Publishing a service with NodePort</h2>
<p>Filename: vote-svc.yaml</p>
<pre><code>---
apiVersion: v1
kind: Service
metadata:
  labels:
    role: svc
    tier: front
  name: front-end
  namespace: mogambo
spec:
  selector:
    app: front-end
  ports:
  - port: 8079
    protocol: TCP
    targetPort: 8079
  type: NodePort
</code></pre>

<p>Save the file.</p>
<p>Now to create a service:</p>
<pre><code>kubectl apply -f frontend-svc.yaml
kubectl get svc
</code></pre>

<p>Now to check which port the pod is connected</p>
<pre><code>kubectl describe service front-end
</code></pre>

<p>Check for the Nodeport here</p>
<p>Sample Output</p>
<pre><code>Name:                     front-end
Namespace:                mogambo
Labels:                   role=svc
                          tier=front
Annotations:              kubectl.kubernetes.io/last-applied-configuration={&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Service&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;labels&quot;:{&quot;role&quot;:&quot;svc&quot;,&quot;tier&quot;:&quot;front&quot;},&quot;name&quot;:&quot;front-end&quot;,&quot;namespace&quot;:&quot;mogambo&quot;},&quot;spec...
Selector:                 app=front-end
Type:                     NodePort
IP:                       10.11.248.77
Port:                     &lt;unset&gt;  8079/TCP
TargetPort:               8079/TCP
NodePort:                 &lt;unset&gt;  30197/TCP
Endpoints:                10.8.1.13:8079,10.8.1.14:8079,10.8.1.15:8079 + 3 more...
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   &lt;none&gt;
</code></pre>

<p>Go to browser and check hostip:NodePort</p>
<p>Here the node port is 30197.</p>
<p>Sample output will be:</p>
<p><img alt="Vote" src="../images/vote.png" /></p>
<h2 id="exposing-the-app-with-externalip">Exposing the app with ExternalIP</h2>
<p><code>file: /k8s-code/projects/mogambo/dev/frontend-svc.yml</code></p>
<pre><code>spec:
  selector:
    app: front-end
  ports:
  - port: 80
    protocol: TCP
    targetPort: 80
  type: NodePort
  externalIPs:
    - 192.168.12.11
    - 192.168.12.12
</code></pre>

<p>apply</p>
<pre><code>kubectl apply -f frontend-svc.yml
kubectl  get svc
kubectl describe svc front-end
</code></pre>

<h2 id="exposing-the-app-with-loadbalancer">Exposing the app with LoadBalancer</h2>
<p>Service type LoadBalancer is only supported on AWS,GCE,Azure and Openstack. If you have you cluster running on any of these clouds, give it a try. It will create a load balancer for us with a ephemeral IP. We can also specify a loadBalancerIP. Mostly not recommended to use. Using service type LoadBalancer will rise your cloud provider spendings. Think about launching 10 load balancers for 10 different services. Thats where <strong>ingress</strong> come into picture (explained in the later part).</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: front-end
  namespace: mogambo
  labels:
    app: front-end
    env: dev
spec:
  selector:
    app: front-end
  ports:
    - protocol: TCP
      port: 8079
  type: LoadBalancer
</code></pre>

<h2 id="headless-services-with-endpointsexternal-names">Headless services with Endpoints/External Names</h2>
<p>Sometimes you may to decouple the services from backend pods. Sometimes you may want to use some external services outside the cluster and want to integrate those external services with the cluster. For these kind of use cases we can use <strong>Headless services</strong>. Let us see an example.</p>
<p>Let us consider a scenario where you have your redis cluster hosted outside the cluster. Your backend in cluster need to use this redis cluster. In this case, you will create a service with ExternalName, which is nothing but a CNAME record of your redis cluster. This type of services will neither have any ports defined nor have any selectors. But, how do you make sure the backend pods uses this service? For that, you will create a custom endpoint, in which map your service to specific endpoints.</p>
<p><code>Ex: External Name service</code></p>
<pre><code>kind: Service
apiVersion: v1
metadata:
  name: redis-aws
  namespace: mogambo
spec:
  type: ExternalName
  externalName: redis.aws.schoolofdevops.com
</code></pre>

<p><code>Ex: Endpoints</code></p>
<pre><code>kind: Endpoints
apiVersion: v1
metadata:
  name: redis-aws
subsets:
  - addresses:
      - ip: 10.40.30.123
      - ip: 10.40.30.324
      - ip: 10.40.30.478
    ports:
      - port: 9376
</code></pre>

<p>These IPs have to be manually managed by the cluster administrator.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../8_rollouts_and_rollbacks/" class="btn btn-neutral float-right" title="Rollouts and Rollbacks">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../6_kubernetes_deployment/" class="btn btn-neutral" title="Creating Deployments"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../6_kubernetes_deployment/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../8_rollouts_and_rollbacks/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
